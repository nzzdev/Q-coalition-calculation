dist: trusty
sudo: true
services:
- docker
language: node_js
node_js:
- '8.1'
install:
- npm install
before_script:
- DOCKER_IMAGE_NAME="q-coalition-calculation"
- DOCKER_TAG=$TRAVIS_BRANCH
script:
- npm run build
- npm test
- docker build -t $DOCKER_IMAGE_NAME:$DOCKER_TAG .
after_success:
- docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"; docker tag $DOCKER_IMAGE_NAME:$DOCKER_TAG
  nzzonline/$DOCKER_IMAGE_NAME:$DOCKER_TAG; docker push nzzonline/$DOCKER_IMAGE_NAME:$DOCKER_TAG;
- if [ $TRAVIS_BRANCH == "staging" ] && [ $TRAVIS_PULL_REQUEST == "false" ]; then
  docker run --rm -it -e RANCHER_URL -e CATTLE_ACCESS_KEY -e CATTLE_SECRET_KEY etlweather/gaucho
  upgrade $RANCHER_SERVICE_ID_STAGING --auto_complete --start_first --imageUuid="docker:nzzonline/$DOCKER_IMAGE_NAME:$DOCKER_TAG"
  || true; fi
cache:
  directories:
  - node_modules
notifications:
  slack:
    secure: 30y+krZ1QzcEHSvo8kwDMO957E8XWsAll6OPb5S2HNi3POwnemFU7MWgyqhJe4Tys0CDwi4DiGguq4HCUDE9aLfC++7wu0eSl6KQYRNaY1usELxFWSagbbc+mW3LSjAtdfJto1O9Du0wF6eERRR1qrH8o3ym6N9mFTVlFHUsV1jPsHtIA+tTEgTJmyberxBlCr5aGzS6vTmS08mwT7Qjj3XWUddAiOIxztDHi7AUA5cIkVZ25MLF424d+RumNh/abBs5fp8ktXnqGGzSRNVV4/8956/T0N7GvOs/bhy6NSPGDrI5gqoc/To1pL6NpedgM6/BBpUDe4t2i0kqvWleWotpP7m2c5LXTmXnIloNy9tdQFCk+6X0hlUJ4nB0jCMkipSnWSMLz03TSu+HdtWz20ghGtbMd8vTjYdOBohtjgCSWPCzlOkNp3AdzcqrdtNH2ozEBqpaRaCulvPav1kvN7L1JoRAjGue92oMlMmtO/va8dyb7EuZroUFsUYXtnakmiuAywUqLhB5PJjfjVWAGOVcaddnH062sD4GXM4gMjlVgPUSEG7v7jBLFePx0PjiXfKoRBU58UflNVhYxmI8O438l8FnvwkroGC+wOq/dH3G1z1IVCpDb/LSk/3Ok+BwzZ8HCbkHNAkMtGk7ZuH4uXErJF8gGQF6kfE7//j0C+U=
